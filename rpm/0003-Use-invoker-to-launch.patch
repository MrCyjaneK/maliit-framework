From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Pekka Vuorela <pekka.vuorela@jollamobile.com>
Date: Wed, 29 Oct 2014 11:50:12 +0200
Subject: [PATCH] Use invoker to launch

Saving a bit of memory
---
 connection/org.maliit.server.service.in | 2 +-
 passthroughserver/main.cpp              | 2 +-
 passthroughserver/passthroughserver.pro | 9 +++++++++
 3 files changed, 11 insertions(+), 2 deletions(-)

diff --git a/connection/org.maliit.server.service.in b/connection/org.maliit.server.service.in
index 0726771..45a81b3 100644
--- a/connection/org.maliit.server.service.in
+++ b/connection/org.maliit.server.service.in
@@ -1,5 +1,5 @@
 [D-BUS Service]
 Name=org.maliit.server
-Exec=@BINDIR@/maliit-server @MALIIT_SERVER_ARGUMENTS@
+Exec=/usr/bin/invoker --type=qt5 @BINDIR@/maliit-server @MALIIT_SERVER_ARGUMENTS@
 SystemdService=maliit-server.service
 
diff --git a/passthroughserver/main.cpp b/passthroughserver/main.cpp
index 63f5cc4..df8ffde 100644
--- a/passthroughserver/main.cpp
+++ b/passthroughserver/main.cpp
@@ -125,7 +125,7 @@ QSharedPointer<Maliit::AbstractPlatform> createPlatform()
 
 } // unnamed namespace
 
-int main(int argc, char **argv)
+Q_DECL_EXPORT int main(int argc, char **argv)
 {
     qInstallMessageHandler(outputMessagesToStdErr);
 
diff --git a/passthroughserver/passthroughserver.pro b/passthroughserver/passthroughserver.pro
index d7af09e..f695415 100644
--- a/passthroughserver/passthroughserver.pro
+++ b/passthroughserver/passthroughserver.pro
@@ -23,6 +23,15 @@ for(OPTION,$$list($$lower($$COV_OPTION))){
     }
 }
 
+packagesExist(qt5-boostable) {
+    message("Building with qt5-boostable support")
+    CONFIG += link_pkgconfig
+    PKGCONFIG += qt5-boostable
+} else {
+    warning("qt5-boostable not available")
+}
+
+
 lipstick:DEFINES+=HAVE_LIPSTICK
 
 QMAKE_CLEAN += *.gcno *.gcda
-- 
2.35.1

